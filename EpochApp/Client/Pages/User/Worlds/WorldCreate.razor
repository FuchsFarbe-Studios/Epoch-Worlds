@page "/User/Worlds/Create"
@page "/User/W/Create"
<PageTitle>@StaticUtils.Constants.AppName - Create World</PageTitle>
@namespace EpochApp.Client.Pages.User
@inherits RequestComponent<EpochApp.Shared.Worlds.World>

<FlatTypo Typo="Typo.Heading3" Color="FlatColor.Info">Create World</FlatTypo>
<EditForm Model="@Model" OnValidSubmit="@(async ctx => await CreateWorldAsync(ctx))">
	<DataAnnotationsValidator />
	<ValidationSummary Model="@Model" />
	<FlatGrid Cols="RowCols.Cols2">
		<FlatGridItem>
			<FlatTextInput @bind-Value="@Model.WorldName" Label="World Name" Placeholder="World Name" Required="true" />
		</FlatGridItem>
		<FlatGridItem>
			<FlatTextInput @bind-Value="@Model.Pronunciation" Label="@nameof(Model.Pronunciation)" Placeholder="@($"/{nameof(Model.Pronunciation)}/")" />
		</FlatGridItem>
	</FlatGrid>

	<FlatGrid Cols="RowCols.Default">
		<FlatTextArea @bind-Value="@Model.Description" HelpText="A brief description of your world." Label="@nameof(Model.Description)" Placeholder="@nameof(Model.Description)" Lines="5" Required="true" />
	</FlatGrid>

	<FlatButton Color="FlatColor.Accent" Edge="EdgeType.RoundMd" Variant="Variant.Default" ButtonType="ButtonType.Submit" Disabled="@_isSubmitting">
		Submit
	</FlatButton>
</EditForm>

@code {
	private bool _isSubmitting;

	private async Task CreateWorldAsync(EditContext ctx)
	{
		_isSubmitting = true;
		Model.OwnerID = Auth.CurrentUser.UserID;

		var result = await Client.PostAsJsonAsync("api/v1/Worlds", Model);
		if (result.IsSuccessStatusCode)
		{
			Nav.NavigateTo("/User/Worlds");
		}
		_isSubmitting = false;
	}
}