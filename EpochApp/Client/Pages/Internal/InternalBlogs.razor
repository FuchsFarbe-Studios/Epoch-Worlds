@page "/InternalBlogs"
@page "/Internal/Blogs"
@using ButtonType=MudBlazor.ButtonType
@using Typo=MudBlazor.Typo
@using Variant=MudBlazor.Variant
@attribute [Authorize(Roles = "ADMIN,INTERNAL")]

<MudText Typo="Typo.h3" Align="Align.Center">Internal Blogs</MudText>

<MudButton Color="Color.Secondary" DisableElevation="true" Size="Size.Large" Variant="Variant.Filled" OnClick="@AddBlogAsync">Add Blog</MudButton>
@if (_showCreateBlog)
{
	<EditForm Model="@_modelBlog" OnSubmit="@CreateNewBlogAsync">
		<MudCard Outlined="true">
			<MudCardContent>
				<MudTextField @bind-Value="@_modelBlog.Name" Label="Blog Name" />
				<MudSelect T="BlogType" @bind-Value="@_modelBlog.BlogType" Margin="Margin.Dense">
					@foreach (var type in Enum.GetValues<BlogType>())
					{
						<MudSelectItem Value="@type">@type.ToDescriptionString()</MudSelectItem>
					}
				</MudSelect>
			</MudCardContent>
			<MudCardActions>
				<MudButton Disabled="@_loading" ButtonType="ButtonType.Submit">Save</MudButton>
			</MudCardActions>
		</MudCard>
	</EditForm>
}

<MudDataGrid @bind-SelectedItem="@_currentEditingBlog" T="BlogDTO" Items="@_blogs" EditMode="@(_isCellEditMode ? DataGridEditMode.Cell : DataGridEditMode.Form)" Bordered="true" Dense="true" CommittedItemChanges="CommitBlogChangesAsync">
	<Columns>
		<PropertyColumn Property="@(x => x.BlogID)" />
		<PropertyColumn Property="@(x => x.BlogType)">
			<EditTemplate>
				<MudSelect T="BlogType" @bind-Value="@context.Item.BlogType" Margin="Margin.Dense">
					@foreach (var type in Enum.GetValues<BlogType>())
					{
						<MudSelectItem Value="@type">@type.ToDescriptionString()</MudSelectItem>
					}
				</MudSelect>
			</EditTemplate>
		</PropertyColumn>
		<PropertyColumn Property="@(x => x.Name)" />
		<PropertyColumn Property="@(x => x.CreatedOn)" />
		<PropertyColumn Property="@(x => x.ModifiedOn)" />
		<PropertyColumn Property="@(x => x.CreatedBy)" />
		<PropertyColumn Property="@(x => x.ModifiedBy)" />
		<TemplateColumn Hidden="@(_isCellEditMode || _readOnly || _editTriggerRowClick)" CellClass="d-flex justify-end">
			<CellTemplate>
				<MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@context.Actions.StartEditingItemAsync" />
			</CellTemplate>
		</TemplateColumn>
	</Columns>
</MudDataGrid>