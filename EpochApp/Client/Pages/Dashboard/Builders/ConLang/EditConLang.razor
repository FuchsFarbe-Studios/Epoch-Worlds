@page "/Builders/ConLang/E/{ContentId}"
@using EpochApp.Shared.Services
@using EpochApp.Client.Shared.Forms
@namespace EpochApp.Client.Pages.Dashboard.Builders
<PageTitle>@StaticUtils.Constants.AppName - Edit Constructed Language</PageTitle>
<FlatTypo Typo="Typo.Heading3">Edit Constructed Language</FlatTypo>

@if (LangContent != null)
{
	<ConLangForm Lang="@LangContent" />
}

@code {
	private ConstructedLanguage LangContent { get; set; } = null!;

	/// <summary>
	///     Content Id of the Constructed Language to edit.
	/// </summary>
	[Parameter] public string ContentId { get; set; }

	[Inject] private HttpClient Client { get; set; }

	[Inject] private ISerializationService Serializer { get; set; }

	[Inject] private NavigationManager Nav { get; set; }

	/// <inheritdoc />
	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
		if (Guid.TryParse(ContentId, out var contentId))
		{
			var content = await Client.GetFromJsonAsync<BuilderContent>($"api/v1/Builder/Content?contentId={contentId}");
			if (content != null)
			{
				var langContent = await Serializer.DeserializeFromXml<ConstructedLanguage>(content.ContentXml);
				if (langContent != null)
					LangContent = langContent;
			}
		}
	}
}