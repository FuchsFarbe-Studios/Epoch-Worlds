@page "/User/Profile"
@using ButtonType=MudBlazor.ButtonType
@using Typo=MudBlazor.Typo
@using Variant=MudBlazor.Variant
@using MudBlazor
@namespace EpochApp.Client.Pages.User

<PageTitle>@StaticUtils.Constants.AppName - @Auth.CurrentUser.UserName - Profile</PageTitle>
<MudText Typo="Typo.h3" Align="Align.Center">Profile</MudText>

@if (_showProfileEdit)
{
	@*		Display Profile Edit Form	*@
	<EditForm Model="@_profileData" OnSubmit="@(async ctx => await UpdateProfileAsync(ctx))">
		<MudGrid Spacing="2">
			<MudItem xs="12" sm="7">
				<MudCard Outlined="true">
					<MudCardHeader>
						<MudText>Edit Profile</MudText>
					</MudCardHeader>
					<MudCardContent>
						<MudGrid>
							<MudItem xs="6">
								<MudTextField Label="Avatar" @bind-Value="@_profileData.AvatarImg" For="@(() => _profileData.AvatarImg)" Disabled="@_updatingProfile" />
							</MudItem>
							<MudItem xs="6">
								<MudTextField Label="Cover Image" @bind-Value="@_profileData.CoverImg" For="@(() => _profileData.CoverImg)" Disabled="@_updatingProfile" />
							</MudItem>
							<MudItem xs="6">
								<UserFileSelector OnFileSelectionChanged="@AvatarImageChanged" />
							</MudItem>
							<MudItem xs="6">
								<UserFileSelector OnFileSelectionChanged="@CoverImageChanged" />
							</MudItem>
							<MudItem xs="12" sm="6">
								<MudTextField Label="First Name" @bind-Value="@_profileData.FirstName" For="@(() => _profileData.FirstName)" Disabled="@_updatingProfile" />
							</MudItem>
							<MudItem xs="12" sm="6">
								<MudTextField Label="Last Name" @bind-Value="@_profileData.LastName" For="@(() => _profileData.LastName)" Disabled="@_updatingProfile" />
							</MudItem>
							<MudItem xs="12">
								<MudTextField Label="Profile Bio" @bind-Value="@_profileData.Bio" For="@(() => _profileData.Bio)" Lines="3" Disabled="@_updatingProfile" />
							</MudItem>
							<MudItem xs="12">
								<MudTextField Label="Signature" @bind-Value="@_profileData.Signature" For="@(() => _profileData.Signature)" HelperText="Signatures are appended to messages." Disabled="@_updatingProfile" />
							</MudItem>
						</MudGrid>
					</MudCardContent>
					<MudCardActions>
						<MudButton Disabled="@_updatingProfile" ButtonType="ButtonType.Submit" DisableElevation="true" Color="Color.Primary" Variant="Variant.Filled">Save Profile <MudIcon Icon="@Icons.Material.Filled.Save"></MudIcon></MudButton>
					</MudCardActions>
				</MudCard>
			</MudItem>
			<MudItem xs="12" sm="5">
				<MudCard Outlined="true">
					<MudCardHeader>
						<MudText>Edit Socials</MudText>
					</MudCardHeader>
					<MudCardContent>
						<MudStack>
							@foreach (var social in _profileData.Socials)
							{
								<MudGrid @key=@social>
									<MudItem xs="5">
										<MudSelect Disabled="@_updatingProfile" Label="Select Social" @bind-Value="@social.Social">
											@foreach (var s in _socials)
											{
												<MudSelectItem Value="@s">@s.SocialMediaName</MudSelectItem>
											}
										</MudSelect>
									</MudItem>
									<MudItem xs="6">
										<MudTextField Disabled="@_updatingProfile" @bind-Value="@social.Handle" For="@(() => social.Handle)" Label="Handle" />
									</MudItem>
									<MudItem xs="1">
										<MudIconButton Disabled="@_updatingProfile" Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(async e => await RemoveSocialAsync(social))" />
									</MudItem>
								</MudGrid>
							}
						</MudStack>
					</MudCardContent>
					<MudCardActions>
						<MudButton OnClick="@(async () => await AddSocialMediaAsync())">Add Social</MudButton>
					</MudCardActions>
				</MudCard>
			</MudItem>
		</MudGrid>
	</EditForm>
}

@if (_profileData != null && !_showProfileEdit)
{
	<MudGrid Spacing="2">
		<MudItem xs="12" sm="7">

			<MudPaper Class="mud-border-secondary pa-4 mt-2" Elevation="0" Width="100%" Outlined="true">
				<MudStack>
					<MudText Typo="Typo.h4">@Auth.CurrentUser.UserName</MudText>
					<MudText Typo="Typo.h5">@_profileData.FirstName @_profileData.LastName</MudText>
					<MudText Typo="Typo.h6">Member Since: @(_profileData?.CreateDate?.ToString("MMMM dd yyyy"))</MudText>
					<MudDivider DividerType="DividerType.Inset" Light="false" />
					<MudText Typo="Typo.body1" Align="Align.Start" GutterBottom="true">@_profileData.Bio</MudText>
					<MudDivider DividerType="DividerType.Inset" Light="false" />
					<MudText Typo="Typo.body2" Color="Color.Primary">@_profileData.Signature</MudText>
					<MudDivider DividerType="DividerType.Inset" Light="false" />
					<MudIconButton Icon="@Icons.Material.Filled.Edit" Title="Edit your profile" OnClick="@(async e => await ToggleEditAsync())" />
				</MudStack>
			</MudPaper>
		</MudItem>

		<MudItem xs="12" sm="5">
			<MudPaper Class="mud-border-secondary pa-4 mt-2" Elevation="0" Width="100%" Outlined="true">
				<MudStack>
					<MudText Typo="Typo.h6" Align="Align.Center" GutterBottom="true">User Socials</MudText>
					<MudTable Bordered="true" Dense="true" Outlined="true" Striped="true" Items="@_profileData.Socials">
						<HeaderContent>
							<MudTh>Social</MudTh>
							<MudTh>Link</MudTh>
						</HeaderContent>
						<RowTemplate>
							<MudTd>@context.Social.SocialMediaName</MudTd>
							<MudTd>
								<MudLink Href="@($"{context.Social.URLAffix}{context.Handle}")">@context.Handle</MudLink>
							</MudTd>
						</RowTemplate>
					</MudTable>
				</MudStack>
			</MudPaper>
		</MudItem>
	</MudGrid>
}